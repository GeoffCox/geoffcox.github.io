import{w as y}from"./index.896ce23e.js";/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const m=typeof WeakRef<"u";class h{constructor(e){m&&typeof e=="object"?this._weakRef=new WeakRef(e):this._instance=e}deref(){var e,t,i;let s;return this._weakRef?(s=(e=this._weakRef)===null||e===void 0?void 0:e.deref(),s||delete this._weakRef):(s=this._instance,!((i=(t=s)===null||t===void 0?void 0:t.isDisposed)===null||i===void 0)&&i.call(t)&&delete this._instance),s}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const _="keyborg:focusin";function v(n){const e=n.HTMLElement,t=e.prototype.focus;let i=!1;return e.prototype.focus=function(){i=!0},n.document.createElement("button").focus(),e.prototype.focus=t,i}let l=!1;function b(n){const e=n;l||(l=v(e));const t=e.HTMLElement.prototype.focus;if(t.__keyborgNativeFocus)return;e.HTMLElement.prototype.focus=s;const i=e.__keyborgData={focusInHandler:o=>{var c;const a=o.target;if(!a)return;const d=document.createEvent("HTMLEvents");d.initEvent(_,!0,!0);const f={relatedTarget:o.relatedTarget||void 0};(l||i.lastFocusedProgrammatically)&&(f.isFocusedProgrammatically=a===((c=i.lastFocusedProgrammatically)===null||c===void 0?void 0:c.deref()),i.lastFocusedProgrammatically=void 0),d.details=f,a.dispatchEvent(d)}};e.document.addEventListener("focusin",e.__keyborgData.focusInHandler,!0);function s(){const o=e.__keyborgData;return o&&(o.lastFocusedProgrammatically=new h(this)),t.apply(this,arguments)}s.__keyborgNativeFocus=t}function k(n){const e=n,t=e.HTMLElement.prototype,i=t.focus.__keyborgNativeFocus,s=e.__keyborgData;s&&(e.document.removeEventListener("focusin",s.focusInHandler,!0),delete e.__keyborgData),i&&(t.focus=i)}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const w=500;let g=0;class p{constructor(){this.__keyborgCoreRefs={},this._isNavigatingWithKeyboard=!1}add(e){const t=e.id;t in this.__keyborgCoreRefs||(this.__keyborgCoreRefs[t]=new h(e))}remove(e){delete this.__keyborgCoreRefs[e],Object.keys(this.__keyborgCoreRefs).length===0&&(this._isNavigatingWithKeyboard=!1)}setVal(e){if(this._isNavigatingWithKeyboard!==e){this._isNavigatingWithKeyboard=e;for(const t of Object.keys(this.__keyborgCoreRefs)){const s=this.__keyborgCoreRefs[t].deref();s?s.update(e):this.remove(t)}}}getVal(){return this._isNavigatingWithKeyboard}}const r=new p;class E{constructor(e,t){this._isMouseUsed=!1,this._onFocusIn=s=>{if(this._isMouseUsed){this._isMouseUsed=!1;return}if(r.getVal())return;const o=s.details;o.relatedTarget&&(o.isFocusedProgrammatically||o.isFocusedProgrammatically===void 0||r.setVal(!0))},this._onMouseDown=s=>{s.buttons===0||s.clientX===0&&s.clientY===0&&s.screenX===0&&s.screenY===0||(this._isMouseUsed=!0,r.setVal(!1))},this._onKeyDown=s=>{var o;const c=r.getVal(),a=s.keyCode,d=this._triggerKeys;!c&&(!d||d.has(a))?r.setVal(!0):c&&(!((o=this._dismissKeys)===null||o===void 0)&&o.has(a))&&this._scheduleDismiss()},this.id="c"+ ++g,this._win=e;const i=e.document;if(t){const s=t.triggerKeys,o=t.dismissKeys;s!=null&&s.length&&(this._triggerKeys=new Set(s)),o!=null&&o.length&&(this._dismissKeys=new Set(o))}i.addEventListener(_,this._onFocusIn,!0),i.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("keydown",this._onKeyDown,!0),b(e),r.add(this)}dispose(){const e=this._win;if(e){this._dismissTimer&&(e.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),k(e);const t=e.document;t.removeEventListener(_,this._onFocusIn,!0),t.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),delete this._win,r.remove(this.id)}}isDisposed(){return!!this._win}update(e){var t,i;const s=(i=(t=this._win)===null||t===void 0?void 0:t.__keyborg)===null||i===void 0?void 0:i.refs;if(s)for(const o of Object.keys(s))u.update(s[o],e)}_scheduleDismiss(){const e=this._win;if(e){this._dismissTimer&&(e.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);const t=e.document.activeElement;this._dismissTimer=e.setTimeout(()=>{this._dismissTimer=void 0;const i=e.document.activeElement;t&&i&&t===i&&r.setVal(!1)},w)}}}class u{constructor(e,t){this._cb=[],this._id="k"+ ++g,this._win=e;const i=e.__keyborg;i?(this._core=i.core,i.refs[this._id]=this):(this._core=new E(e,t),e.__keyborg={core:this._core,refs:{[this._id]:this}})}static create(e,t){return new u(e,t)}static dispose(e){e.dispose()}static update(e,t){e._cb.forEach(i=>i(t))}dispose(){var e;const t=(e=this._win)===null||e===void 0?void 0:e.__keyborg;t!=null&&t.refs[this._id]&&(delete t.refs[this._id],Object.keys(t.refs).length===0&&(t.core.dispose(),delete this._win.__keyborg)),this._cb=[],delete this._core,delete this._win}isNavigatingWithKeyboard(){return r.getVal()}subscribe(e){this._cb.push(e)}unsubscribe(e){const t=this._cb.indexOf(e);t>=0&&this._cb.splice(t,1)}setVal(e){r.setVal(e)}}function F(n,e){return u.create(n,e)}const T=y(!1,n=>{let e=F(window);n(e.isNavigatingWithKeyboard());const t=i=>{n(i)};return e.subscribe(t),()=>{e.unsubscribe(t)}});export{T as u};
